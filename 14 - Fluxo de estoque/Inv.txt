-- =============================================
-- Autor		      : Diego Miller
-- Data de Criação    : 10/11/2015
-- Descrição          : Validação de integração da intranet para o zeus dos inventários
-- Bancos Utilizados  : Intranet e Zeus_RTG
-- Datas de Alteracao : 12/11/2015
-- =============================================
SELECT 
		ID
		,CONVERT(DATE,DATA) AS DATA
		,ARQUIVO
		,COD_LOJA
		,COD_EAN
		,CAST(QTDE AS DOUBLE PRECISION) AS QTDE_ARQUIVO
		,CAST(QTDE_EST_DIA AS DOUBLE PRECISION) AS QTDE_EST_DIA
		,CAST(QTDE_AJUSTE AS DOUBLE PRECISION) AS QTDE_AJUSTE
		,CAST (QTDE_CONTAGEM AS DOUBLE PRECISION) AS QTDE_CONTAGEM 
		,CONVERT(DATE,DTA_INVENTARIO) AS DTA_INVENTARIO
		,COD_PRODUTO
		,STATUS
		,(CASE WHEN  QTDE_AJUSTE > 0 THEN '300'  ELSE '199' END) AS COD_AJUSTE
INTO #TEMP_TAB_IMPORT_ARQ
FROM 
		INTRANET.DBO.TAB_INVENTROTATIVO_CTRL AS TAB 
WHERE 1=1 
		AND DTA_INVENTARIO >= ('2016-01-01')	
		AND QTDE_AJUSTE <> 0

SELECT 
		*
FROM 
		#TEMP_TAB_IMPORT_ARQ AS TAB 
LEFT JOIN TAB_AJUSTE_ESTOQUE AS AJUSTE WITH (NOLOCK)
		ON AJUSTE.COD_LOJA = TAB.COD_LOJA AND AJUSTE.COD_AJUSTE = TAB.COD_AJUSTE AND AJUSTE.COD_PRODUTO = TAB.COD_PRODUTO AND AJUSTE.DTA_AJUSTE = TAB.DTA_INVENTARIO

WHERE 1=1 
		AND COD_AJUSTE_ESTOQUE IS NULL